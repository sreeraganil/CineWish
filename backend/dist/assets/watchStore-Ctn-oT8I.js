import{r as d,j as e,L as x,e as f,A as p}from"./index-CZzhZSbx.js";const g=(s=0)=>{const l=Math.floor(s/60),t=s%60;return`${l}:${t.toString().padStart(2,"0")}`},b=(s=0,l=0)=>l?Math.min(100,Math.floor(s/l*100)):0,v=({items:s,onRemove:l})=>{const t=d.useRef(null),[o,a]=d.useState(!1);if(!(s!=null&&s.length))return null;const i=()=>{const r=t.current;r&&a(r.scrollWidth>r.clientWidth+1)};d.useEffect(()=>(i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)),[s]);const h=r=>{const n=t.current;if(!n)return;const c=r*(n.clientWidth-200);n.scrollBy({left:c,behavior:"smooth"})};return e.jsxs("section",{className:"pb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-teal-400",children:"Continue Watching"}),e.jsxs("div",{className:"relative group px-2",children:[o&&e.jsx("button",{onClick:()=>h(-1),"aria-label":"Scroll left",className:"hidden sm:flex absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-4 z-20 bg-teal-500 hover:bg-teal-400 text-white p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),o&&e.jsx("button",{onClick:()=>h(1),"aria-label":"Scroll right",className:"hidden sm:flex absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-4 z-20 bg-teal-500 hover:bg-teal-400 text-white p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("div",{ref:t,className:"flex gap-4 md:gap-5 overflow-x-auto scrollbar-hide scroll-smooth",children:s.map(r=>{const n=b(r.progressSeconds,r.durationSeconds),c=r.mediaType==="tv"?`/watch/tv/${r.mediaId}/${r.season}/${r.episode}`:`/watch/movie/${r.mediaId}`;return e.jsxs("div",{className:"group/card flex-none w-[200px] sm:w-[240px] lg:w-[280px]",children:[e.jsxs("div",{className:"relative",children:[e.jsx(x,{to:c,state:{title:r.title,progressSeconds:r.progressSeconds,poster:r.poster,backdrop:r.backdrop},children:e.jsxs("div",{className:"relative aspect-video rounded-xl overflow-hidden bg-gray-800 transition-all duration-300 border border-gray-800 hover:border-teal-500/50",children:[r.backdrop?e.jsx("img",{src:r.backdrop,alt:r.title,className:"w-full h-full object-cover group-hover/card:scale-110 transition-transform duration-500",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500 text-sm",children:e.jsx("svg",{className:"w-16 h-16 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/card:opacity-100 transition-opacity duration-300",children:e.jsx("div",{className:"bg-teal-500/90 backdrop-blur-sm rounded-full p-3 transform group-hover/card:scale-110 transition-transform duration-300 shadow-xl border border-teal-400/50",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-teal-400 to-teal-500 transition-all duration-300",style:{width:`${n}%`}})}),e.jsx("div",{className:"absolute top-1 left-2",children:e.jsx("span",{className:"bg-teal-600 backdrop-blur-sm text-white text-[9px] font-bold px-2 py-0.5 rounded-full uppercase shadow-lg border border-white/20",children:r.mediaType==="tv"?`S${r.season}E${r.episode}`:"Movie"})})]})}),e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),l==null||l(r)},"aria-label":"Remove from continue watching",className:"absolute top-2 right-2 w-6 h-6 rounded-full bg-black/70 backdrop-blur-sm text-white text-sm hover:bg-red-600 hover:scale-110 transition-all duration-200 flex items-center justify-center border border-white/20 shadow-lg",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mt-2 px-1",children:[e.jsx("h3",{className:"text-xs sm:text-sm font-semibold text-white truncate group-hover/card:text-teal-400 transition-colors mb-1",children:r.title??`Media ${r.mediaId}`}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] sm:text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:g(r.progressSeconds)})]}),e.jsxs("span",{className:"text-teal-400 font-medium",children:[Math.round(n),"%"]})]})]})]},`${r.mediaType}-${r.mediaId}-${r.season}-${r.episode}`)})})]})]})},j=f((s,l)=>({continueWatching:[],history:[],loading:!1,fetchWatchProgress:async()=>{s({loading:!0});try{const{data:t}=await p.get("/watch/progress");s({continueWatching:t.filter(o=>o.status==="watching"),history:t.filter(o=>o.status==="completed"),loading:!1})}catch(t){console.error("Failed to fetch watch progress",t),s({loading:!1})}},removeFromHistory:async t=>{s(o=>({continueWatching:o.continueWatching.filter(a=>!(a.mediaType===t.mediaType&&a.mediaId===t.mediaId&&a.season===t.season&&a.episode===t.episode)),history:o.history.filter(a=>!(a.mediaType===t.mediaType&&a.mediaId===t.mediaId&&a.season===t.season&&a.episode===t.episode))}));try{await p.delete(`/watch/history/${t.mediaType}/${t.mediaId}`,{params:t.mediaType==="tv"?{season:t.season,episode:t.episode}:{}})}catch(o){console.error("Failed to remove item",o),s(a=>({continueWatching:[...a.continueWatching,t],history:[...a.history,t]}))}}}));export{v as C,j as w};

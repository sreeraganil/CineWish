import{c as y,d as k,a as N,r as n,A as E,j as o,B as j}from"./index-Dce_IDGO.js";const $=()=>{const{media:a,id:r,s:l="1",e:c="1"}=y(),{state:e}=k(),w=N(),[d,p]=n.useState(!0),m=n.useRef(0),b=n.useRef(null),g=n.useMemo(()=>{const t=a==="tv"?`https://www.vidking.net/embed/tv/${r}/${l}/${c}`:`https://www.vidking.net/embed/movie/${r}`,i=new URLSearchParams({color:"009689",autoPlay:"true"});return`${t}?${i.toString()}`},[r,a,l,c]),f=n.useCallback(async(t,i)=>{if(t<5)return;const s=Date.now();if(!(s-m.current<15e3)){m.current=s;try{await E.post("/watch/progress",{mediaType:a,mediaId:Number(r),season:a==="tv"?Number(l):null,episode:a==="tv"?Number(c):null,progressSeconds:Math.floor(t),durationSeconds:Math.floor(i),poster:e==null?void 0:e.poster,backdrop:e==null?void 0:e.backdrop,title:e==null?void 0:e.title})}catch{console.warn("Backend progress sync failed")}}},[a,r,l,c,e]);return n.useEffect(()=>{e!=null&&e.title||w(`/details/${a}/${r}`);const t=s=>{if(s.origin.includes("vidking.net"))try{const u=typeof s.data=="string"?JSON.parse(s.data):s.data;if(u.type==="PLAYER_EVENT"){const{event:x,currentTime:h,duration:v}=u.data||{};x==="timeupdate"&&(d&&p(!1),f(h,v))}}catch{}};window.addEventListener("message",t);const i=setTimeout(()=>p(!1),8e3);return()=>{window.removeEventListener("message",t),clearTimeout(i)}},[d,f]),o.jsxs("div",{className:"relative w-screen h-screen overflow-hidden bg-black flex flex-col font-sans",children:[o.jsx(j,{title:e==null?void 0:e.title}),d&&o.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black z-40",children:[o.jsx("div",{className:"w-12 h-12 border-[3px] border-teal-500/20 border-t-teal-500 rounded-full animate-spin"}),o.jsx("p",{className:"mt-4 text-zinc-500 text-[9px] font-black uppercase tracking-[0.3em] animate-pulse",children:"Establishing Stream"})]}),o.jsx("iframe",{ref:b,src:g,className:`w-full h-[calc(100vh-72px)] border-none transition-opacity duration-700 ${d?"opacity-0":"opacity-100"}`,allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",allowFullScreen:!0,sandbox:"allow-scripts allow-same-origin allow-forms allow-presentation",onLoad:()=>setTimeout(()=>p(!1),2e3)})]})};export{$ as default};

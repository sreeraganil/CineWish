import{b as K,r,a as B,u as Q,A as E,j as t}from"./index-CZzhZSbx.js";import{H as U}from"./Header-CfVJw4Ab.js";import{T as G}from"./index-BiRmOZSn.js";import{C as J}from"./CardSkeleton-BdTlfYOo.js";const ee=()=>{const[p,I]=K(),[h,x]=r.useState(!1),T=B(),{searchResult:i,setSearchResult:v}=Q(),b=r.useRef(null),[d,j]=r.useState([]),[M,A]=r.useState(!1),[C,n]=r.useState(!1),[q,P]=r.useState(!1),[u,R]=r.useState(1),[w,N]=r.useState(!1),[m,g]=r.useState(-1),S=r.useRef(null),L=r.useRef(null),y=r.useRef([]),$=r.useRef(null),l=p.get("q")||"",f=p.get("t")||"";r.useEffect(()=>{var e;l||(v([]),(e=b.current)==null||e.focus())},[]),r.useEffect(()=>{l.trim()&&_()},[f]),r.useEffect(()=>{if(l.trim().length<2){j([]),n(!1);return}g(-1),y.current=[];const e=setTimeout(()=>{q&&F(l)},600);return()=>clearTimeout(e)},[l]),r.useEffect(()=>{const e=s=>{S.current&&!S.current.contains(s.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.useEffect(()=>{if(m<0||!L.current)return;const e=y.current[m];e&&e.scrollIntoView({behavior:"auto",block:"nearest"})},[m]),r.useEffect(()=>{u>1&&z()},[u]),r.useEffect(()=>{if(!w)return;const e=new IntersectionObserver(a=>{a[0].isIntersecting&&!h&&R(o=>o+1)}),s=$.current;return s&&e.observe(s),()=>s&&e.unobserve(s)},[w,h]);const F=async e=>{A(!0);try{const{data:s}=await E.get("/tmdb/search",{params:{query:e,type:"multi"}}),o=(Array.isArray(s.data)?s.data:[]).filter(c=>c.media_type==="tv"||c.media_type==="movie").slice(0,7);j(o),n(o.length>0)}catch(s){console.error("Suggestion error:",s),j([]),n(!1)}finally{A(!1)}},_=async e=>{var o;e&&e.preventDefault(),n(!1),(o=b.current)==null||o.blur(),g(-1);const s=p.get("q")||"",a=p.get("t")||"multi";if(s.trim()){x(!0),R(1),v([]),N(!1);try{const{data:c}=await E.get("/tmdb/search",{params:{query:s,type:a,page:1}}),V=Array.isArray(c.data)?c.data:[];v(V),N((c.total_pages||0)>1)}catch(c){console.error(c)}finally{x(!1)}}},z=async()=>{x(!0);try{const{data:e}=await E.get("/tmdb/search",{params:{query:l,type:f||"multi",page:u}}),s=Array.isArray(e.data)?e.data:[];v([...i,...s]),N((e.total_pages||0)>u)}catch(e){console.error(e)}finally{x(!1)}},k=(e,s)=>{!e||!s||(T(`/details/${e}/${s}`),n(!1),g(-1))},D=(e,s)=>{const a=Object.fromEntries(p.entries());I({...a,[s]:e.target.value},{replace:!0}),P(!0)},H=()=>{l.trim().length>1&&d.length>0&&n(!0)},O=e=>{if(!(!C||d.length===0))switch(e.key){case"ArrowDown":e.preventDefault(),g(s=>s===d.length-1?0:s+1);break;case"ArrowUp":e.preventDefault(),g(s=>s<=0?d.length-1:s-1);break;case"Enter":if(m>-1){e.preventDefault();const s=d[m];k(s.media_type,s.id)}break;case"Escape":n(!1),g(-1);break}};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-950 to-black text-white pb-20 md:pb-0",children:[t.jsx(U,{}),t.jsxs("div",{ref:S,className:"relative max-w-xl mx-1 sm:mx-auto my-6 flex gap-1 sm:gap-2 items-center",children:[t.jsxs("form",{onSubmit:_,className:"relative flex items-center flex-1",children:[t.jsx("input",{type:"text",ref:b,value:l,onChange:e=>D(e,"q"),onFocus:H,onKeyDown:O,placeholder:f==="movie"?"Search for movies...":f==="tv"?"Search for series...":"Search for movies or series...",className:"flex-1 px-4 pr-12 py-2 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-teal-500",autoComplete:"off"}),t.jsx("span",{onClick:_,className:"material-symbols-outlined absolute top-1/2 right-4 transform -translate-y-1/2 cursor-pointer text-gray-400 hover:text-white",children:"search"}),C&&t.jsx("div",{ref:L,className:"absolute top-full left-0 right-0 mt-2 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-20 max-h-96 overflow-y-auto",children:M?t.jsx("p",{className:"text-gray-400 text-sm p-3 text-center",children:"Loading..."}):t.jsxs("ul",{className:"divide-y divide-gray-700",children:[(y.current=[])&&null,d.length>0?d.map((e,s)=>t.jsxs("li",{ref:a=>y.current[s]=a,onClick:()=>k(e.media_type,e.id),onMouseEnter:()=>g(s),className:`flex items-center p-2 cursor-pointer transition-colors ${m===s?"bg-gray-700":"hover:bg-gray-700"}`,children:[t.jsx("img",{src:e.poster_path?`https://image.tmdb.org/t/p/w92${e.poster_path}`:"/placeholder.png",alt:e.title||e.name,className:"w-10 h-14 object-cover rounded flex-shrink-0"}),t.jsxs("div",{className:"ml-3 overflow-hidden",children:[t.jsx("h4",{className:"text-sm font-semibold truncate",children:e.title||e.name}),t.jsxs("p",{className:"text-xs text-gray-400 capitalize",children:[e.media_type==="movie"?"Movie":"TV Show",(e.release_date||e.first_air_date)&&` (${(e.release_date||e.first_air_date).slice(0,4)})`]})]})]},e.id)):t.jsx("p",{className:"text-gray-500 text-sm p-3 text-center",children:"No suggestions found"})]})})]}),t.jsx("div",{className:"sm:px-2 bg-gray-800 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-teal-500",children:t.jsxs("select",{name:"type",value:f,onChange:e=>D(e,"t"),className:"bg-gray-800 text-white py-[10px] text-sm border-none outline-none",children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"movie",children:"Movies"}),t.jsx("option",{value:"tv",children:"TV"})]})})]}),h&&u===1&&t.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}),!h&&u===1&&(i==null?void 0:i.length)===0&&t.jsxs("div",{className:"relative w-full flex flex-col items-center justify-center gap-4",children:[t.jsx(G,{src:"/lottie/no_result.lottie",loop:!0,autoplay:!0,style:{width:"clamp(100px, 40vw, 200px)",height:"clamp(100px, 40vw, 200px)",borderRadius:"50%",overflow:"hidden",marginTop:"100px"}}),t.jsx("p",{className:"text-center text-gray-600",children:"No results"})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-7 2xl:grid-cols-8 gap-4 px-4 md:mx-5 pb-4",children:[i==null?void 0:i.map((e,s)=>{var a,o;return t.jsxs("div",{onClick:()=>k(e.media_type||f,e.id),className:"relative bg-gray-900 border border-gray-800 rounded-lg overflow-hidden shadow hover:shadow-teal-500/10 transition",children:[t.jsx("img",{src:e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"/placeholder.png",alt:e.title||e.name,className:"h-60 w-full object-cover object-top"}),t.jsxs("div",{className:"p-3",children:[t.jsx("h3",{className:"text-sm font-semibold truncate",children:e.title||e.name}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:((a=e.release_date)==null?void 0:a.slice(0,4))||((o=e.first_air_date)==null?void 0:o.slice(0,4))||"N/A"}),!!(e.vote_average&&parseFloat(e.vote_average)>0)&&t.jsx("div",{className:"absolute top-2 left-2",children:t.jsxs("div",{className:"flex items-center gap-1 bg-black/60 backdrop-blur-sm px-2 py-1 rounded-full",children:[t.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),t.jsx("span",{className:"text-white text-xs font-semibold",children:e.vote_average.toFixed(1)})]})})]}),t.jsx("span",{className:"absolute top-2 right-2 bg-teal-600 text-white text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase shadow-md",children:e.media_type||f})]},`${e.id}-${s}`)}),h&&Array.from({length:12}).map((e,s)=>t.jsx(J,{},`skeleton-${s}`))]}),t.jsx("div",{ref:$,className:"h-20 flex justify-center items-center",children:h&&u>1&&w&&t.jsx("p",{className:"text-gray-400",children:"Loading more..."})})]})};export{ee as default};
